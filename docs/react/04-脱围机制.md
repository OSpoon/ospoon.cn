# 脱围机制 Escape Hatches

脱围机制是 React 提供给开发者一种在必要时刻绕过框架直接使用较低级别的 API 或原生 DOM API 进行底层操作的机制。例如：操作浏览器 API 实现输入框聚集，或者存储和操作 DOM 元素等。

## Ref 

组件中用于存储与渲染无关的值可以使用 `ref`，它是一个普通的 JavaScript 对象，在更改其值时不会触发组件重新渲染。如果试图使用 `ref` 存储渲染所需的状态，那么组件的行为将难以预测。

### 为组件添加 ref：

通过 `react` 导入 `useRef` Hook API：

```jsx
import { useRef } from 'react';
```

调用 `useRef` Hook 声明 `ref` 并提供初始值：

```jsx
const ref = useRef(0); // 提供 0 为 ref 的初始值
```

读取/修改 `ref` 当前的值：

```jsx
console.log(ref.current); // 读取 ref 当前的值

ref.current = ref.current + 1; // 读取并修改 ref 当前的值
```

### ref 与 state 的不同：

在 React 框架中大多数情况仍建议使用 state，`ref` 作为一种“脱围机制”，仅在存储与渲染无关的值时使用。

| ref                                                     | `state`                                                      |
| :------------------------------------------------------ | ------------------------------------------------------------ |
| `useRef(initialValue)` 返回 `{ current: initialValue }` | `useState(initialValue)` 返回 `state` 变量的当前值和一个 `state` 设置函数（`[value, setValue]`） |
| 更改时不会触发重新渲染                                  | 更改时触发重新渲染                                           |
| 可变——可以在渲染过程之外修改和更新 `current` 的值       | “不可变”——必须使用 state 设置函数修改 state 变量，从而排队重新渲染 |
| 不应在渲染期间读取（或写入）`current` 值                | 可以随时读取 state，但每次渲染都有自己不变的 state 快照      |

### 使用 ref 引用值





### 使用 ref 操作 DOM

在 React 中 DOM 渲染由框架自动处理，因此在组件中通常不需要操作 DOM。对于 React 没有内置的一些操作 DOM 的情况，例如，让文本输入框获得焦点、滚动元素或测量元素的尺寸等就需要用到 `ref` 来指向 DOM ，从而使用原生 API 操作。



## Effect



## Hook

